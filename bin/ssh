#!/bin/sh
set -e

if command -v gopass >>/dev/null; then
	eval "$(ssh-agent)" >>/dev/null
	trap "ssh-agent -k >>/dev/null" EXIT
	for key in $(gopass ls -f ssh/ | grep privkey); do
		gopass show -n "$key" | ssh-add -q - &
	done
fi

wait
/usr/bin/ssh "$@"
